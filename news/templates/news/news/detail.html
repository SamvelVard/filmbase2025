{% extends 'films/base.html' %}

{% load static %}

{% block title %}{{ news.title }}{% endblock %}

{% block content %}
<div class="news-detail">
    <h4 style='color: #3480eb'>–ö–∏–Ω–æ–Ω–æ–≤–æ—Å—Ç–∏</h4>
    <h2>{{ news.title }}</h2>

    <div class="news-meta">
        <span class="news-date">
            {{ news.published_at|date:"d.m.Y" }}
        </span>
        <span class="news-views">
            ìÅº {{ news.views_count|default:"0" }}
        </span>
    </div>

{#    {% if news.image %}#}
{#    <div class="news-main-image">#}
{#        <img src="{{ news.image.url }}" alt="{{ news.title }}">#}
{#    </div>#}
{#    {% endif %}#}

    <div class="news-blocks">
        {% for block in news_blocks %}
        <div class="news-block">
            {% if block.title %}
            <h3>{{ block.title }}</h3>
            {% endif %}
            
            {% if block.content %}
            <div class="block-content">
                {{ block.content|linebreaks }}
            </div>
            {% endif %}
            
            {% if block.image %}
            <div class="block-image-position">
                <img src="{{ block.image.url }}" alt="{{ block.title|default:'–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ' }}" class="block-image">
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>

    <div class="news-reactions">
        <form method="post" action="{% url 'news:news_reaction_create' news.id %}">
            {% csrf_token %}
            <input type="hidden" name="reaction_type" value="1"> <!-- LIKE = 1 -->
            <button type="submit" class="reaction-btn">
                üëç {{ item.likes_count|default:"0" }}
            </button>
        </form>

        <form method="post" action="{% url 'news:news_reaction_create' news.id %}">
            {% csrf_token %}
            <input type="hidden" name="reaction_type" value="-1">
            <button type="submit" class="reaction-btn">
                üëé {{ item.dislikes_count|default:"0" }}
            </button>
        </form>
    </div>

    <div class="comments-section">
        <h3>üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ ({{ comments|length }})</h3>
        {% for comment in comments %}
            {% for comment_form in comment_form %}
        <div class="comment">
            <span class="comment-author">{{ comment.user.username }}</span>
            <div class="comment-content">
                {{ comment.content|linebreaks }}
            </div>
            <div class="comment-meta">
                <span class="comment-date">{{ comment.published_at|date:"d.m H:i" }}</span>
                <div class="comment-reaction-btn">
                    <form method="post" action="{% url 'news:comment_reaction_create' comment.id %}">
                        {% csrf_token %}
                        <input type="hidden" name="reaction_type" value="1"> <!-- LIKE = 1 -->
                        <button type="submit" class="reaction-btn">
                            üëç {{ item.comment.likes_count|default:"0" }}
                        </button>
                    </form>
                    <form method="post" action="{% url 'news:comment_reaction_create' comment.id %}">
                        {% csrf_token %}
                        <input type="hidden" name="reaction_type" value="-1"> <!-- DISLIKE = -1 -->
                        <button type="submit" class="reaction-btn">
                            üëé {{ item.comment.dislikes_count|default:"0" }}
                        </button>
                    </form>
                </div>
            </div>
        </div>
        {% empty %}
        <p class="no-comments">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ–∫–∞ –Ω–µ—Ç. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</p>
        {% endfor %}
    </div>

    {% if user.is_authenticated %}
    <div class="add-comment">
        <h4>–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</h4>
        <form method="post" action="{% url 'news:comment_create' news.id %}">
            {% csrf_token %}
            <textarea name="content" rows="4" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." required></textarea>
            <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </form>
    </div>
    {% else %}
    <div class="login-to-comment">
        <p><a href="{% url 'login' %}">–í–æ–π–¥–∏—Ç–µ</a>, —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</p>
    </div>
    {% endif %}
</div>
{% endblock %}
{% extends 'news/base.html' %}

{% block title %}{{ news.title }}{% endblock %}

{% block content %}
<div class="news-detail">
    <!-- –ó–ê–ì–û–õ–û–í–û–ö -->
    <h1>{{ news.title }}</h1>
    
    <!-- –î–ê–¢–ê –ü–£–ë–õ–ò–ö–ê–¶–ò–ò -->
    <div class="news-meta">
        <span class="news-date">
            üìÖ {{ news.published_at|date:"d.m.Y H:i" }}
        </span>
        <span class="news-views">
            üëÅÔ∏è {{ news.views_count|default:"0" }}
        </span>
    </div>

    <!-- –ì–õ–ê–í–ù–û–ï –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ï -->
    {% if news.image %}
    <div class="news-main-image">
        <img src="{{ news.image.url }}" alt="{{ news.title }}">
    </div>
    {% endif %}

    <!-- –ë–õ–û–ö–ò –ù–û–í–û–°–¢–ò -->
    <div class="news-blocks">
        {% for block in news_blocks %}
        <div class="news-block">
            {% if block.title %}
            <h2>{{ block.title }}</h2>
            {% endif %}
            
            {% if block.content %}
            <div class="block-content">
                {{ block.content|linebreaks }}
            </div>
            {% endif %}
            
            {% if block.image %}
            <div class="block-image">
                <img src="{{ block.image.url }}" alt="{{ block.title|default:'–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ' }}">
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>

    <!-- –†–ï–ê–ö–¶–ò–ò –ù–ê –ù–û–í–û–°–¢–¨ -->
    <div class="news-reactions">
        <form method="post" action="{% url 'news:news_reaction_create' news.id %}">
            {% csrf_token %}
            <input type="hidden" name="reaction_type" value="1"> <!-- LIKE = 1 -->
            <button type="submit" class="reaction-btn like-btn">
                üëç {{ item.likes_count|default:"0" }}
            </button>
        </form>

        <form method="post" action="{% url 'news:news_reaction_create' news.id %}">
            {% csrf_token %}
            <input type="hidden" name="reaction_type" value="-1"> <!-- DISLIKE = -1 -->
            <button type="submit" class="reaction-btn dislike-btn">
                üëé {{ item.dislikes_count|default:"0" }}
            </button>
        </form>
    </div>

    <!-- –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ò -->
    <div class="comments-section">
        <h3>üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ ({{ comments|length }})</h3>

        {% for comment in comments %}
        <div class="comment">
            <div class="comment-header">
                <span class="comment-author">{{ comment.user.username }}</span>
                <span class="comment-date">{{ comment.published_at|date:"d.m.Y H:i" }}</span>
            </div>

            <div class="comment-content">
                {{ comment.content|linebreaks }}
            </div>

            <!-- –†–ï–ê–ö–¶–ò–ò –ù–ê –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ô -->
            <div class="comment-reactions">
                <form method="post" action="{% url 'news:comment_reaction_create' comment.id %}">
                    {% csrf_token %}
                    <input type="hidden" name="reaction_type" value="1"> <!-- LIKE = 1 -->
                    <button type="submit" class="comment-reaction-btn">
                        üëç {{ item.comment.likes_count|default:"0" }}
                    </button>
                </form>

                <form method="post" action="{% url 'news:comment_reaction_create' comment.id %}">
                    {% csrf_token %}
                    <input type="hidden" name="reaction_type" value="-1"> <!-- DISLIKE = -1 -->
                    <button type="submit" class="comment-reaction-btn">
                        üëé {{ item.comment.dislikes_count|default:"0" }}
                    </button>
                </form>
            </div>
        </div>
        {% empty %}
        <p class="no-comments">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ–∫–∞ –Ω–µ—Ç. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</p>
        {% endfor %}
    </div>

    <!-- –§–û–†–ú–ê –î–û–ë–ê–í–õ–ï–ù–ò–Ø –ö–û–ú–ú–ï–ù–¢–ê–†–ò–Ø -->
    {% if user.is_authenticated %}
    <div class="add-comment">
        <h4>–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</h4>
        <form method="post" action="{% url 'news:comment_create' news.id %}">
            {% csrf_token %}
            <textarea name="content" rows="4" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." required></textarea>
            <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </form>
    </div>
    {% else %}
    <div class="login-to-comment">
        <p><a href="{% url 'login' %}">–í–æ–π–¥–∏—Ç–µ</a>, —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</p>
    </div>
    {% endif %}
</div>
{% endblock %}
{% extends 'films/base.html' %}

{% load static %}

{% block title %}{{ news.title }}{% endblock %}

{% block content %}
<div class="news-detail">
    <h4 style='color: #3480eb'>–ö–∏–Ω–æ–Ω–æ–≤–æ—Å—Ç–∏</h4>
    <h2>{{ news.title }}</h2>

    <div class="news-meta">
        <span class="news-date">
            {{ news.published_at|date:"d.m.Y" }}
        </span>
        <span class="news-views">
            ìÅº {{ news.views_count|default:"0" }}
        </span>
    </div>

{#    {% if news.image %}#}
{#    <div class="news-main-image">#}
{#        <img src="{{ news.image.url }}" alt="{{ news.title }}">#}
{#    </div>#}
{#    {% endif %}#}

    <div class="news-blocks">
        {% for block in news_blocks %}
        <div class="news-block">
            {% if block.title %}
            <h3>{{ block.title }}</h3>
            {% endif %}
            
            {% if block.content %}
            <div class="block-content">
                {{ block.content|linebreaks }}
            </div>
            {% endif %}
            
            {% if block.image %}
            <div class="block-image-position">
                <img src="{{ block.image.url }}" alt="{{ block.title|default:'–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ' }}" class="block-image">
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>

    <div class="news-reactions">
        <form method="post" action="{% url 'news:news_reaction_create' news.id %}">
            {% csrf_token %}
            <input type="hidden" name="reaction_type" value="1"> <!-- LIKE = 1 -->
            <button type="submit" class="reaction-btn">
                üëç {{ news.likes_count|default:"0" }}
            </button>
        </form>

        <form method="post" action="{% url 'news:news_reaction_create' news.id %}">
            {% csrf_token %}
            <input type="hidden" name="reaction_type" value="-1">
            <button type="submit" class="reaction-btn">
                üëé {{ news.dislikes_count|default:"0" }}
            </button>
        </form>
    </div>

    <div class="comments-section">
        <h3>üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ ({{ comments.count }})</h3>

        {% for comment in comments %}
        {% if not comment.parent %}
            <div class="comment">
            {% include "news/news/comment.html" with comment=comment is_reply=False %}

            {% with replies=comment.replies.all %}
            {% if replies %}
                {% for replie in replies %}
                    {% include "news/news/comment.html" with comment=replie is_reply=True %}
                {% endfor %}
            {% endif %}
            {% endwith %}

            </div>
        {% endif %}
        {% endfor %}
        {% if user.is_authenticated %}
        <div class="add-comment">
            <h4>–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</h4>
            <form method="post" action="{% url 'news:comment_create' news.id %}">
                {% csrf_token %}
                <textarea name="content" rows="2" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." required></textarea>
                <button type="submit" class="comment-reaction-btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </form>
        </div>
        {% else %}
        <div class="login-to-comment">
            <p><a href="{% url 'login' %}">–í–æ–π–¥–∏—Ç–µ</a>, —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</p>
        </div>
        {% endif %}
    </div>

</div>
{% endblock %}
{% extends 'films/base.html' %}

{% load static %}

{% block title %}{{ news.title }}{% endblock %}

{% block content %}
<div class="news-detail">
    <h1 style='color: #3480eb'>
        –ö–∏–Ω–æ–Ω–æ–≤–æ—Å—Ç–∏
        {% if user.is_superuser %}
            <a href="{% url 'news:news_block_create' news.id %}" title="–î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫ –∫ —ç—Ç–æ–π –Ω–æ–≤–æ—Å—Ç–∏" class="btn btn-primary"><i class="bi-plus-lg"></i></a>
        {% endif %}
    </h1>

    <h2>{{ news.title }}</h2>
    {% if user.is_superuser %}
    {% endif %}

    <div class="news-meta">
        <span class="news-date">
            {{ news.published_at|date:"d.m.Y" }}
        </span>
        <span class="news-views">
            ìÅº {{ news.views_count|default:"0" }}
        </span>
    </div>

{#    {% if news.image %}#}
{#    <div class="news-main-image">#}
{#        <img src="{{ news.image.url }}" alt="{{ news.title }}">#}
{#    </div>#}
{#    {% endif %}#}

    <div class="news-blocks">
        {% for block in news_blocks %}
            <div class="news-block text-bg-secondary p-3">
                {% if block.title %}
                <h3>{{ block.title }}</h3>
                {% endif %}

                {% if user.is_superuser %}
                <div class="mt-3 d-flex gap-2">
                    <a href="{% url 'news:news_block_update' block.id %}" class="btn btn-primary btn-sm">
                        <i class="bi-pencil-square"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                    </a>
                    <a href="{% url 'news:news_block_delete' block.id %}" class="btn btn-danger btn-sm">
                        <i class="bi-trash"></i> –£–¥–∞–ª–∏—Ç—å
                    </a>
                </div>
                {% endif %}

                {% if block.content %}
                <div class="block-content">
                    {{ block.content|linebreaks }}
                </div>
                {% endif %}

                {% if block.image %}
                <div class="block-image-position">
                    <img src="{{ block.image.url }}" alt="{{ block.title|default:'–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ' }}" class="block-image">
                </div>
                {% endif %}
            </div>
        {% endfor %}
    </div>

    <div class="news-reactions">
        <form method="post" action="{% url 'news:news_reaction_create' news.id %}">
            {% csrf_token %}
            <input type="hidden" name="reaction_type" value="1"> <!-- LIKE = 1 -->
            <button type="submit" class="reaction-btn">
                üëç {{ news.likes_count|default:"0" }}
            </button>
        </form>

        <form method="post" action="{% url 'news:news_reaction_create' news.id %}">
            {% csrf_token %}
            <input type="hidden" name="reaction_type" value="-1">
            <button type="submit" class="reaction-btn">
                üëé {{ news.dislikes_count|default:"0" }}
            </button>
        </form>
    </div>

    <div class="comments-section">
        <h3>üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ ({{ comments.count }})</h3>

        {% for comment in comments %}
        {% if not comment.parent %}
            <div class="comment">
            {% include "news/comment.html" with comment=comment is_reply=False %}

            {% with replies=comment.replies.all %}
            {% if replies %}
                {% for replie in replies %}
                    {% include "news/comment.html" with comment=replie is_reply=True %}
                {% endfor %}
            {% endif %}
            {% endwith %}

            </div>
        {% endif %}
        {% endfor %}
        {% if user.is_authenticated %}
        <div class="add-comment">
            <h4>–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</h4>
            <form method="post" action="{% url 'news:comment_create' news.id %}">
                {% csrf_token %}
                <textarea name="content" rows="2" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." required></textarea>
                <button type="submit" class="comment-reaction-btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </form>
        </div>
        {% else %}
        <div class="login-to-comment">
            <p><a href="{% url 'login' %}">–í–æ–π–¥–∏—Ç–µ</a>, —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</p>
        </div>
        {% endif %}
    </div>

</div>
{% endblock %}